# cmdk å…¨å±€æœç´¢è®¾è®¡æ€»ç»“

## ğŸ“‹ é¡¹ç›®æ¦‚è§ˆ

ä¸º Pi Session Manager æ·»åŠ åŸºäº cmdk åº“çš„å…¨å±€æœç´¢åŠŸèƒ½ï¼Œé‡‡ç”¨æ’ä»¶å¼æ¶æ„è®¾è®¡ã€‚

**çŠ¶æ€**: âœ… è®¾è®¡å®Œæˆï¼Œå¾…å®æ–½  
**å¤æ‚åº¦**: L3ï¼ˆå¤æ‚ä»»åŠ¡ï¼‰  
**é¢„è®¡å·¥æœŸ**: 3-5 å¤©  
**åˆ›å»ºæ—¥æœŸ**: 2026-01-31

---

## ğŸ¯ æ ¸å¿ƒç›®æ ‡

1. **å…¨å±€è®¿é—®**: `Cmd+K` / `Ctrl+K` å¿«æ·é”®å¿«é€Ÿæ‰“å¼€
2. **å¤šæºæœç´¢**: æ”¯æŒæœç´¢ç”¨æˆ·æ¶ˆæ¯ã€é¡¹ç›®ã€ä¼šè¯
3. **å¯æ‰©å±•æ€§**: æ’ä»¶å¼æ¶æ„ï¼Œæ–¹ä¾¿æ·»åŠ æ–°åŠŸèƒ½
4. **é«˜æ€§èƒ½**: é˜²æŠ–ã€è™šæ‹Ÿæ»šåŠ¨ã€ç¼“å­˜ä¼˜åŒ–
5. **ç¾è§‚ UI**: ç°ä»£åŒ–è®¾è®¡ï¼Œæµç•…åŠ¨ç”»

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### ç³»ç»Ÿåˆ†å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CommandPalette              â”‚  â† UI å®¹å™¨å±‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚       CommandMenu             â”‚  â”‚  â† cmdk ç»„ä»¶å±‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      useCommandMenu Hook            â”‚  â† çŠ¶æ€ç®¡ç†å±‚
â”‚      useSearchPlugins Hook          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       PluginRegistry                â”‚  â† æ’ä»¶ç³»ç»Ÿå±‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚Msg  â”‚  â”‚Proj â”‚  â”‚Sess â”‚  ...    â”‚  â† æ’ä»¶å®ç°å±‚
â”‚  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ components/command/          # cmdk ç»„ä»¶
â”‚   â”œâ”€â”€ CommandPalette.tsx       # å®¹å™¨
â”‚   â”œâ”€â”€ CommandMenu.tsx          # ä¸»ç»„ä»¶
â”‚   â”œâ”€â”€ CommandItem.tsx          # ç»“æœé¡¹
â”‚   â”œâ”€â”€ CommandEmpty.tsx         # ç©ºçŠ¶æ€
â”‚   â””â”€â”€ CommandLoading.tsx       # åŠ è½½çŠ¶æ€
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useCommandMenu.ts        # çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ useSearchPlugins.ts      # æ’ä»¶ç®¡ç†
â”‚   â””â”€â”€ useSearchCache.ts        # æœç´¢ç¼“å­˜
â”œâ”€â”€ plugins/
â”‚   â”œâ”€â”€ types.ts                 # æ’ä»¶æ¥å£
â”‚   â”œâ”€â”€ registry.ts              # æ’ä»¶æ³¨å†Œè¡¨
â”‚   â”œâ”€â”€ base/
â”‚   â”‚   â””â”€â”€ BaseSearchPlugin.ts  # æ’ä»¶åŸºç±»
â”‚   â”œâ”€â”€ message/
â”‚   â”‚   â””â”€â”€ MessageSearchPlugin.ts
â”‚   â”œâ”€â”€ project/
â”‚   â”‚   â””â”€â”€ ProjectSearchPlugin.ts
â”‚   â””â”€â”€ session/
â”‚       â””â”€â”€ SessionSearchPlugin.ts
â””â”€â”€ utils/
    â”œâ”€â”€ highlight.ts             # é«˜äº®å·¥å…·
    â””â”€â”€ search.ts                # æœç´¢å·¥å…·
```

---

## ğŸ”Œ æ’ä»¶ç³»ç»Ÿ

### æ ¸å¿ƒæ¥å£

```typescript
interface SearchPlugin {
  // å…ƒæ•°æ®
  id: string
  name: string
  icon: React.ComponentType
  description: string
  keywords: string[]
  priority: number
  
  // æ ¸å¿ƒæ–¹æ³•
  search(query: string, context: SearchContext): Promise<SearchPluginResult[]>
  onSelect(result: SearchPluginResult, context: SearchContext): void
  
  // å¯é€‰æ–¹æ³•
  renderItem?(result: SearchPluginResult): React.ReactNode
  isEnabled?(context: SearchContext): boolean
}
```

### å†…ç½®æ’ä»¶

| æ’ä»¶ | åŠŸèƒ½ | ä¼˜å…ˆçº§ |
|------|------|--------|
| MessageSearchPlugin | æœç´¢ç”¨æˆ·æ¶ˆæ¯å’ŒåŠ©æ‰‹å›å¤ | 80 |
| ProjectSearchPlugin | æœç´¢é¡¹ç›® | 70 |
| SessionSearchPlugin | æœç´¢ä¼šè¯åç§°å’Œå…ƒæ•°æ® | 60 |

### æ‰©å±•æ€§

- âœ… æ”¯æŒæ³¨å†Œè‡ªå®šä¹‰æ’ä»¶
- âœ… æ’ä»¶éš”ç¦»ï¼Œäº’ä¸å½±å“
- âœ… æ’ä»¶ä¼˜å…ˆçº§æ§åˆ¶
- âœ… æ’ä»¶å¯ç”¨/ç¦ç”¨æ§åˆ¶

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

### æœç´¢ä¼˜åŒ–

- **é˜²æŠ–**: 300ms å»¶è¿Ÿï¼Œé¿å…é¢‘ç¹æœç´¢
- **å–æ¶ˆè¯·æ±‚**: ä½¿ç”¨ AbortController å–æ¶ˆæœªå®Œæˆçš„æœç´¢
- **å¹¶è¡Œæœç´¢**: æ‰€æœ‰æ’ä»¶å¹¶è¡Œæ‰§è¡Œï¼Œä½¿ç”¨ Promise.all()

### æ¸²æŸ“ä¼˜åŒ–

- **è™šæ‹Ÿæ»šåŠ¨**: è¶…è¿‡ 50 æ¡ç»“æœä½¿ç”¨ @tanstack/react-virtual
- **æ‡’åŠ è½½**: æ’ä»¶æŒ‰éœ€åŠ è½½
- **React.memo**: ä¼˜åŒ–ç»„ä»¶é‡æ¸²æŸ“

### ç¼“å­˜ç­–ç•¥

- **LRU Cache**: ç¼“å­˜æœ€è¿‘ 100 æ¬¡æœç´¢ç»“æœ
- **ç¼“å­˜é”®**: `${pluginId}:${query}`
- **ç¼“å­˜æ—¶é—´**: 5 åˆ†é’Ÿ
- **è‡ªåŠ¨æ¸…ç†**: å…³é—­é¢æ¿æ—¶æ¸…ç†è¿‡æœŸç¼“å­˜

### æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ |
|------|------|
| æœç´¢å“åº”æ—¶é—´ | < 300msï¼ˆ1000 æ¡æ•°æ®ï¼‰ |
| é¦–æ¬¡æ¸²æŸ“æ—¶é—´ | < 100ms |
| è™šæ‹Ÿæ»šåŠ¨å¸§ç‡ | 60fps |
| å†…å­˜å ç”¨ | < 50MBï¼ˆ10000 æ¡ç¼“å­˜ï¼‰ |

---

## ğŸ¨ UI/UX è®¾è®¡

### å¸ƒå±€

- **é¢æ¿å®½åº¦**: 640px (max-w-2xl)
- **é¢æ¿é«˜åº¦**: æœ€å¤§ 60vh
- **ä½ç½®**: å‚ç›´å±…ä¸­ï¼Œè·é¡¶éƒ¨ 20vh
- **èƒŒæ™¯é®ç½©**: rgba(0, 0, 0, 0.5)

### é¢œè‰²ï¼ˆæš—è‰²ä¸»é¢˜ï¼‰

| å…ƒç´  | é¢œè‰² |
|------|------|
| èƒŒæ™¯ | #1a1b26 |
| è¾¹æ¡† | #2a2b36 |
| è¾“å…¥æ¡† | #252636 |
| é€‰ä¸­é¡¹ | #2a2b36 |
| æ–‡æœ¬ | #c0caf5 |
| æ¬¡è¦æ–‡æœ¬ | #565f89 |
| é«˜äº® | #7aa2f7 |

### åŠ¨ç”»

- **æ‰“å¼€/å…³é—­**: fade + scale (200ms ease-out)
- **ç»“æœåˆ—è¡¨**: fade + slide-up (150ms ease-out)
- **åŠ è½½çŠ¶æ€**: spin (1s linear infinite)

### å¿«æ·é”®

| å¿«æ·é”® | åŠŸèƒ½ |
|--------|------|
| Cmd+K / Ctrl+K | æ‰“å¼€å‘½ä»¤é¢æ¿ |
| ESC | å…³é—­å‘½ä»¤é¢æ¿ |
| â†‘ / â†“ | å¯¼èˆªç»“æœ |
| Enter | é€‰æ‹©ç»“æœ |

---

## ğŸŒ å›½é™…åŒ–

### æ”¯æŒè¯­è¨€

- âœ… ä¸­æ–‡ï¼ˆç®€ä½“ï¼‰
- âœ… è‹±æ–‡

### ç¿»è¯‘æ–‡æ¡ˆ

```json
{
  "command": {
    "placeholder": "æœç´¢ä¼šè¯ã€é¡¹ç›®ã€æ¶ˆæ¯...",
    "empty": "æœªæ‰¾åˆ°ç»“æœ",
    "loading": "æœç´¢ä¸­...",
    "plugins": {
      "messageSearch": "æ¶ˆæ¯æœç´¢",
      "projectSearch": "é¡¹ç›®æœç´¢",
      "sessionSearch": "ä¼šè¯æœç´¢"
    }
  }
}
```

---

## ğŸ“¦ æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| cmdk | ^1.0.0 | å‘½ä»¤é¢æ¿æ ¸å¿ƒåº“ |
| React | ^18.3.1 | UI æ¡†æ¶ |
| TypeScript | ^5.6.3 | ç±»å‹ç³»ç»Ÿ |
| @tanstack/react-virtual | ^3.10.8 | è™šæ‹Ÿæ»šåŠ¨ |
| Tailwind CSS | ^3.4.0 | æ ·å¼ç³»ç»Ÿ |
| i18next | ^25.8.0 | å›½é™…åŒ– |

---

## ğŸ“ å®æ–½è®¡åˆ’

### Phase 2: æ ¸å¿ƒæ¶æ„ï¼ˆ1 å¤©ï¼‰
- å®‰è£… cmdk ä¾èµ–
- åˆ›å»ºæ’ä»¶ç³»ç»ŸåŸºç¡€è®¾æ–½
- å®ç° Hooksï¼ˆuseCommandMenu, useSearchPlugins, useSearchCacheï¼‰
- åˆ›å»ºæ ¸å¿ƒç»„ä»¶ï¼ˆCommandPalette, CommandMenu, CommandItemï¼‰

### Phase 3: å†…ç½®æ’ä»¶ï¼ˆ1 å¤©ï¼‰
- å®ç° MessageSearchPlugin
- å®ç° ProjectSearchPlugin
- å®ç° SessionSearchPlugin

### Phase 4: UI/UX ä¼˜åŒ–ï¼ˆ0.5 å¤©ï¼‰
- è®¾è®¡æ ·å¼ï¼ˆcommand.cssï¼‰
- å®ç°é«˜äº®åŒ¹é…æ–‡æœ¬
- ä¼˜åŒ–é”®ç›˜å¯¼èˆª

### Phase 5: æ€§èƒ½ä¼˜åŒ–ï¼ˆ0.5 å¤©ï¼‰
- å®ç°è™šæ‹Ÿæ»šåŠ¨
- ä¼˜åŒ–æœç´¢æ€§èƒ½
- å®ç°ç¼“å­˜ç­–ç•¥

### Phase 6: é›†æˆå’Œæµ‹è¯•ï¼ˆ1 å¤©ï¼‰
- é›†æˆåˆ° App.tsx
- æ·»åŠ å›½é™…åŒ–ç¿»è¯‘
- åŠŸèƒ½æµ‹è¯•
- æ€§èƒ½æµ‹è¯•

### Phase 7: æ–‡æ¡£å’Œäº¤ä»˜ï¼ˆ0.5 å¤©ï¼‰
- æ›´æ–° README.md
- ç¼–å†™æ’ä»¶å¼€å‘æŒ‡å—
- åˆ›å»º PR
- ä»£ç å®¡æŸ¥

**é¢„è®¡å®Œæˆæ—¶é—´**: 2026-02-05

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½æ€§
- [ ] Cmd+K / Ctrl+K æ‰“å¼€å‘½ä»¤é¢æ¿
- [ ] å®æ—¶æœç´¢ï¼ˆé˜²æŠ– 300msï¼‰
- [ ] æœç´¢ç”¨æˆ·æ¶ˆæ¯ã€é¡¹ç›®ã€ä¼šè¯
- [ ] é€‰æ‹©ç»“æœå¯¼èˆª
- [ ] ESC å…³é—­é¢æ¿

### æ€§èƒ½
- [ ] æœç´¢å“åº”æ—¶é—´ < 300msï¼ˆ1000 æ¡æ•°æ®ï¼‰
- [ ] é¦–æ¬¡æ¸²æŸ“æ—¶é—´ < 100ms
- [ ] è™šæ‹Ÿæ»šåŠ¨æµç•…ï¼ˆ60fpsï¼‰
- [ ] å†…å­˜å ç”¨ < 50MB

### UI/UX
- [ ] é¢æ¿å±…ä¸­æ˜¾ç¤º
- [ ] åŠé€æ˜èƒŒæ™¯é®ç½©
- [ ] å¹³æ»‘åŠ¨ç”»
- [ ] é«˜äº®åŒ¹é…æ–‡æœ¬
- [ ] é”®ç›˜å¯¼èˆªæµç•…

### å›½é™…åŒ–
- [ ] ä¸­è‹±æ–‡åˆ‡æ¢
- [ ] æ‰€æœ‰æ–‡æœ¬å·²ç¿»è¯‘

---

## ğŸ”® æœªæ¥æ‰©å±•

### å‘½ä»¤æ’ä»¶
- å¯¼å‡ºä¼šè¯
- åˆ é™¤ä¼šè¯
- åˆ‡æ¢ä¸»é¢˜
- æ‰“å¼€è®¾ç½®

### AI æœç´¢
- è¯­ä¹‰æœç´¢
- å‘é‡ç›¸ä¼¼åº¦
- è‡ªç„¶è¯­è¨€æŸ¥è¯¢

### æœç´¢å†å²
- æœ€è¿‘æœç´¢
- çƒ­é—¨æœç´¢
- æœç´¢å»ºè®®

### è‡ªå®šä¹‰æ’ä»¶
- æ’ä»¶ API æ–‡æ¡£
- æ’ä»¶å¸‚åœº
- æ’ä»¶é…ç½®ç•Œé¢

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **Issue**: `docs/issues/20260131-Add cmdk global search with plugin architecture.md`
- **æ¶æ„è®¾è®¡**: `docs/architecture/cmdk-plugin-system.md`
- **å®æ–½è®¡åˆ’**: `docs/CMDK_IMPLEMENTATION_PLAN.md`
- **cmdk å®˜æ–¹æ–‡æ¡£**: https://cmdk.paco.me/

---

## ğŸ‰ æ€»ç»“

æœ¬è®¾è®¡æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„ã€å¯æ‰©å±•çš„ cmdk å…¨å±€æœç´¢ç³»ç»Ÿï¼š

**æ ¸å¿ƒä¼˜åŠ¿**:
- âœ… æ’ä»¶å¼æ¶æ„ï¼Œæ˜“äºæ‰©å±•
- âœ… é«˜æ€§èƒ½ä¼˜åŒ–ï¼ˆé˜²æŠ–ã€è™šæ‹Ÿæ»šåŠ¨ã€ç¼“å­˜ï¼‰
- âœ… ç¾è§‚çš„ UI è®¾è®¡
- âœ… å®Œå–„çš„ç±»å‹ç³»ç»Ÿ
- âœ… å›½é™…åŒ–æ”¯æŒ
- âœ… è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒ

**æŠ€æœ¯äº®ç‚¹**:
- ä½¿ç”¨ cmdk åº“æä¾›ä¸“ä¸šçš„å‘½ä»¤é¢æ¿ä½“éªŒ
- æ’ä»¶ç³»ç»ŸåŸºäºæ¥å£è®¾è®¡ï¼Œç¬¦åˆ SOLID åŸåˆ™
- æ€§èƒ½ä¼˜åŒ–ç­–ç•¥å…¨é¢
- ç»„ä»¶è®¾è®¡æ¨¡å—åŒ–ï¼ŒèŒè´£æ¸…æ™°
- å®Œå–„çš„é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µè€ƒè™‘

**ä¸‹ä¸€æ­¥**: å¼€å§‹ Phase 2ï¼ˆæ ¸å¿ƒæ¶æ„å®ç°ï¼‰

---

*è®¾è®¡å®Œæˆæ—¥æœŸ: 2026-01-31*  
*è®¾è®¡è€…: Pi Agent*
