# PR: i18n 文件拆分与修复

**日期**: 2026-01-31
**状态**: Done

## 概述

将大型 i18n 语言文件拆分为模块化结构，提高可维护性和可读性。同时修复了所有缺失的翻译键。

## 变更前

```
src/i18n/locales/
├── en-US.ts  (约 14KB，单个文件包含所有翻译)
└── zh-CN.ts  (约 13KB，单个文件包含所有翻译)
```

## 变更后

```
src/i18n/locales/
├── en-US/
│   ├── index.ts          # 组合所有模块
│   ├── common.ts         # 通用文本
│   ├── app.ts            # 应用相关
│   ├── session.ts        # 会话相关
│   ├── project.ts        # 项目相关
│   ├── search.ts         # 搜索相关
│   ├── export.ts         # 导出相关
│   ├── stats.ts          # 统计相关
│   ├── dashboard.ts      # 仪表板相关
│   ├── languageSwitcher.ts # 语言切换
│   ├── settings.ts       # 设置相关
│   ├── components.ts     # 组件相关
│   ├── command.ts        # 命令相关
│   └── role.ts           # 角色相关
└── zh-CN/
    ├── index.ts
    ├── common.ts
    ├── app.ts
    ├── session.ts
    ├── project.ts
    ├── search.ts
    ├── export.ts
    ├── stats.ts
    ├── dashboard.ts
    ├── languageSwitcher.ts
    ├── settings.ts
    ├── components.ts
    ├── command.ts
    └── role.ts
```

## 模块说明

| 模块 | 说明 |
|------|------|
| common | 通用文本（按钮、状态等） |
| app | 应用级别配置和错误信息 |
| session | 会话相关功能 |
| project | 项目相关功能 |
| search | 搜索功能 |
| export | 导出功能 |
| stats | 统计面板 |
| dashboard | 仪表板 |
| languageSwitcher | 语言切换器 |
| settings | 设置页面 |
| components | 组件相关文本 |
| command | 命令面板 |
| role | 角色定义 |

## 优点

1. **可维护性**: 每个模块独立，修改时只需关注相关文件
2. **可读性**: 文件更小，更容易定位和修改翻译
3. **协作友好**: 多人并行修改不同模块时减少冲突
4. **按需加载**: 未来可支持懒加载模块减少包体积

## 技术细节

- 使用 TypeScript `as const` 保持类型推断
- `export` 是保留字，模块内部使用 `exportModule`，导出时映射为 `export`
- 保持原有 API 不变，无需修改使用代码

## 验证

```bash
# TypeScript 检查通过
npx tsc --noEmit

# 功能验证通过
npx tsx test-i18n-split.ts
# 输出: Test passed!

# 翻译同步验证
npx tsx final-i18n-check.ts
# 输出: ✅ All translations are synchronized!
```

### 统计数据

- **en-US**: 446 个翻译键
- **zh-CN**: 446 个翻译键
- **同步率**: 100%

## 兼容性

- ✅ 向后兼容，无需修改使用代码
- ✅ TypeScript 类型保持不变
- ✅ 运行时行为完全一致

## 修复的问题

### 1. ExportDialog 键不匹配
- **问题**: 代码使用 `formats.html.name`，翻译文件使用 `label`
- **修复**: 统一使用 `name`，添加 `untitledSession` 和 `cancel` 键

### 2. Session 模块缺失键
- **问题**: 缺少 `session.header.*`, `session.tree.*`, `session.viewer.*` 等键
- **修复**: 添加所有缺失的 session 相关键

### 3. Dashboard 模块缺失键
- **问题**: 缺少 `dashboard.messageDistribution.*`, `dashboard.tokenStats.*` 等键
- **修复**: 添加所有缺失的 dashboard 相关键

### 4. Components 模块缺失键
- **问题**: 缺少 `components.sessionTree.filter*`, `components.activityHeatmap.*` 等键
- **修复**: 添加所有缺失的 components 相关键

### 5. 其他模块缺失键
- **common**: 添加 `unknown`, `deleteSession`, `confirmDelete`
- **search**: 添加 `searching`, `results`
- **stats**: 添加 `cards.sessions`, `cards.messages`
- **command**: 添加 `hints.*` 对象
- **project**: 添加 `sessionCount`

## 后续建议

1. ✅ 添加翻译验证工具检查缺失的 key（已完成）
2. 考虑按路由懒加载翻译模块
3. 考虑添加翻译管理工具（如 i18next-scanner）自动提取翻译
## 硬编码文本修复

### 扫描结果
- **扫描范围**: src/components/ 目录下所有 .tsx 文件
- **发现**: 9 处硬编码用户可见文本
- **状态**: ✅ 已修复

### 修复详情
| 文件 | 修复内容 |
|------|---------|
| `ReadExecution.tsx` | 添加 `imageAlt` 翻译键 |
| `UserMessage.tsx` | 添加 `imageAlt` 翻译键 |
| `dashboard/Achievements.tsx` | 添加 `powerUserMessage` 翻译键 |
| `dashboard/TimeDistribution.tsx` | 添加 `noActivityData`, `dailyViewComingSoon` 翻译键 |
| `dashboard/TokenStats.tsx` | 添加 `topModelsByCost` 翻译键 |
| `dashboard/TopModelsChart.tsx` | 添加 `noModelData` 翻译键 |
| `settings/SettingsPanel.tsx` | 添加 `commandExample` 翻译键 |
| `settings/sections/TerminalSettings.tsx` | 添加 `commandExample` 翻译键 |

### 新增翻译键 (10 个)
- `components.readExecution.imageAlt`
- `components.userMessage.imageAlt`
- `dashboard.achievements.powerUserMessage`
- `components.dashboard.noActivityData`
- `components.dashboard.dailyViewComingSoon`
- `components.dashboard.topModelsByCost`
- `components.dashboard.noModelData`
- `settings.terminal.commandExample` (en-US)
- `settings.terminal.commandExample` (zh-CN)

详细报告见: [docs/pr/20260131-i18n-hardcoded-scan.md](./pr/20260131-i18n-hardcoded-scan.md)
